---
title: "Stat4911PracticeProject"
author: "Armaan Sodhi.23"
date: "2025-01-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
install.packages("nyfcflights13")
library(nycflights13)
library(ggplot2)
library(dplyr)
library
```

```{r}
airlines <- nycflights13::airlines
airports <- nycflights13::airports
flights <- nycflights13::flights
planes <- nycflights13::planes
weather <- nycflights13::weather
```

```{r}
top10AirportsDest <- flights %>%
  group_by(dest) %>%
  count %>%
  arrange(desc(n)) %>%
  head(10)
```

```{r}
ggplot(top10AirportsDest, aes(x = reorder(dest, -n), y = n)) +
    geom_bar(stat = "identity") +
  labs(title = "Top 10 Airports by Destination",
       x = "Destination Airport",
       y = "Count") +
  theme_minimal()
```

```{r}
AirportOrigin <- flights %>%
  group_by(origin) %>%
  count %>%
  arrange(desc(n)) %>%
  head(10)
```

```{r}
ggplot(AirportOrigin, aes(x = reorder(origin, -n), y = n)) +
    geom_bar(stat = "identity") +
  labs(title = "Top Airports by Origin",
       x = "Origin Airport",
       y = "Count") +
  theme_minimal()
```

```{r}
flights %>%
  group_by(dest) %>%
  count() %>%
  summarise(frequency = n,
            origin) %>%
  arrange(-frequency)

flights <- flights %>%
  drop_na()

weather <- weather %>%
  drop_na()

length(flights)

flights$delay <- TRUE


range(flights$dep_delay)
for (i in 1:nrow(flights)) {
  if (flights$dep_delay[i] >= 15) {
    flights$delay[i] = TRUE}
  else if (flights$dep_delay[i] >= 0 && flights$dep_delay[i] < 15) {
    flights$delay[i] = FALSE
  } else {
    flights$delay[i] = "Early"
  }
  }

flights %>%
  count(delay)

flights$dep_delay

str(flights)
```

```{r plane sizes}

planes$size <- "Small"

for (i in 1:nrow(planes)) {
  if (planes$seats[i] > 25 && planes$seats[i] <= 180) {
    planes$size[i] = "Medium"}
  else if (planes$size[i] > 180) {
    planes$size[i] = "Large"
  }
  }

```

To look at for weather relationship with delay:
  humid
  

  wind_dir
  wind_speed
  precip
  visib


#Merges 
```{r}
merged <- right_join(flights, weather, by = c("origin", "time_hour"))
view(merged)
```


#Gets delayed/non-delayed flights
```{r}
delayFlights <- merged %>%
  filter(merged$delay == "TRUE")

nonDelayFlights <- merged %>%
  filter(merged$delay == "FALSE")
```


#EDA with Delayed/non-delayed Flights
```{r}
mean(delayFlights$visib)
mean(nonDelayFlights$visib)
```

```{r}
merged <- merged %>%
  mutate(delay = as.character(delay)) %>%
  mutate(delay = case_when(
    delay == "TRUE" ~ 1,
    delay == "Early" ~ -1,
    delay == "FALSE" ~ 0,
))
view(merged)
```

```{r}
modelWeather <- glm(delay ~ temp + dewp + humid + wind_dir + wind_speed + wind_gust + precip + pressure + visib, data = merged)
summary(modelWeather)
```
We find that precip has a p value of 0.667210 which is greater than our alpha value of .05 so we would say that precipitation does not have a noticeable effect on delayed flights in the origin airport.
We find that wind speed has a p value of 0.490046 which is greater than our alpha value of .05 so we would say that precipitation does not have a noticeable effect on delayed flights in the origin airport.


```{r}
modelWeather <- glm(delay ~ temp + dewp + humid + wind_dir + wind_gust + pressure + visib, data = merged)
summary(modelWeather)
```


#Trees then Bagging then Forest
```{r}
set.seed(101)  
trainIndex <- sample(1:nrow(merged), 0.7 * nrow(merged))

trainData <- merged[trainIndex, ]
testData <- merged[-trainIndex, ]


```
